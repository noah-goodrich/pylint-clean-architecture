# Excelsior Prompt Registry
# Key: {linter}.{rule_code} — universal key for AI and tooling.
# manual_instructions: how to fix a violation (reactive).
# proactive_guidance: how to write code that avoids the violation (for generation).
# references: optional URLs.

# --- Mypy (type_integrity) ---
mypy.type-arg:
  short_description: "Missing type parameters for generic type"
  manual_instructions: "Add an explicit type annotation. Example: x: int = 1. Use typing.List, Dict, Optional, etc. when needed."
  proactive_guidance: "When using generics (list, dict, Optional, etc.), always supply type parameters (e.g. dict[str, int], list[str]). Avoid bare dict, list, Optional without type args."
  references: ["https://mypy.readthedocs.io/"]

mypy.arg-type:
  short_description: "Argument type incompatible with signature"
  manual_instructions: "Make the argument type match the function signature. Add a type cast (e.g. cast(...)) if the value is correct but mypy cannot infer it."
  proactive_guidance: "Pass arguments whose types match the declared parameter types. Use cast() only when you know the runtime type is correct and mypy cannot infer it."
  references: ["https://mypy.readthedocs.io/"]

mypy.return-value:
  short_description: "Return value incompatible with return type"
  manual_instructions: "Ensure the return value matches the declared return type. Fix the implementation or update the return type hint."
  proactive_guidance: "Return values must match the declared return type. Update the annotation or the implementation so they align."
  references: ["https://mypy.readthedocs.io/"]

mypy.assignment:
  short_description: "Incompatible types in assignment"
  manual_instructions: "Ensure the assigned value matches the variable's type. Change the value, add a cast, or fix the variable's annotation."
  proactive_guidance: "Annotate variables with the type you assign (e.g. x: str = 'hello'). Avoid assigning a value of one type to a variable annotated as another."
  references: ["https://mypy.readthedocs.io/"]

mypy.no-untyped-def:
  short_description: "Function missing type annotations"
  manual_instructions: "Add type annotations to all parameters and the return type. Example: def f(x: int) -> str: ..."
  proactive_guidance: "Add type hints to every function: parameters and return type (use -> None for no return). Example: def f(x: int) -> str: ..."
  references: ["https://mypy.readthedocs.io/"]

mypy.no-untyped-call:
  short_description: "Call to untyped function"
  manual_instructions: "The function being called lacks type annotations. Add types to that function's parameters and return value."
  proactive_guidance: "Ensure callees have type annotations so mypy can check the call. Add types to the definition of the function being called."
  references: ["https://mypy.readthedocs.io/"]

mypy.var-annotated:
  short_description: "Variable needs type annotation"
  manual_instructions: "Add a type annotation to the variable. Example: my_var: List[str] = []"
  proactive_guidance: "Annotate variables when their type is not obvious from the initializer (e.g. my_var: list[str] = []). Use explicit annotations for empty containers and complex types."
  references: ["https://mypy.readthedocs.io/"]

mypy.union-attr:
  short_description: "Attribute access on Union type"
  manual_instructions: "Use a type guard before accessing attributes. Example: if isinstance(x, Foo): x.bar  # mypy knows x is Foo here."
  proactive_guidance: "Narrow Union types with isinstance() or other type guards before accessing type-specific attributes."
  references: ["https://mypy.readthedocs.io/"]

mypy.attr-defined:
  short_description: "Attribute not defined on type"
  manual_instructions: "The attribute is not defined on the type. Check spelling, or add the attribute to the class definition."
  proactive_guidance: "Only access attributes that exist on the declared type. Add the attribute to the class or use a type that declares it."
  references: ["https://mypy.readthedocs.io/"]

mypy.valid-type:
  short_description: "Invalid use as a type"
  manual_instructions: "See Mypy docs: https://mypy.readthedocs.io/ Fix types at the reported location."
  proactive_guidance: "Use types from typing (e.g. List, Dict) or built-in generics (list, dict) correctly. Do not use runtime values (e.g. any) as type annotations."
  references: ["https://mypy.readthedocs.io/"]

mypy.override:
  short_description: "Signature incompatible with supertype"
  manual_instructions: "See Mypy docs: https://mypy.readthedocs.io/ Fix types at the reported location."
  proactive_guidance: "When implementing a protocol or overriding a method, match the supertype's signature exactly (parameter names, types, return type)."
  references: ["https://mypy.readthedocs.io/"]

mypy.no-redef:
  short_description: "Redefinition of name"
  manual_instructions: "See Mypy docs: https://mypy.readthedocs.io/ Fix types at the reported location."
  proactive_guidance: "Avoid redefining the same name in the same scope. Use a different name or restructure the code."
  references: ["https://mypy.readthedocs.io/"]

mypy.no-any-return:
  short_description: "Returning Any from function with concrete return type"
  manual_instructions: "See Mypy docs: https://mypy.readthedocs.io/ Fix types at the reported location."
  proactive_guidance: "Ensure the returned value is typed. If calling something that returns Any, annotate the result or narrow the type before returning."
  references: ["https://mypy.readthedocs.io/"]

mypy.import-not-found:
  short_description: "Module or import not found"
  manual_instructions: "See Mypy docs: https://mypy.readthedocs.io/ Fix types at the reported location."
  proactive_guidance: "Install missing dependencies or add stubs (e.g. stubs/<module>/). Use TYPE_CHECKING for optional imports where appropriate."
  references: ["https://mypy.readthedocs.io/"]

# Default for any other mypy code
mypy._default:
  short_description: "Mypy type error"
  manual_instructions: "See Mypy docs: https://mypy.readthedocs.io/ Fix types at the reported location."
  proactive_guidance: "Add or fix type annotations so types are consistent and mypy can verify the code."

# --- Ruff (code_quality / import_typing) ---
ruff.ARG001:
  short_description: "Unused function argument"
  manual_instructions: "Remove unused function argument or prefix with underscore (_arg) to indicate intentional non-use."
  proactive_guidance: "Remove arguments you do not use, or prefix with underscore (e.g. _request) to mark intentionally unused."
  references: ["https://docs.astral.sh/ruff/rules/"]

ruff.ARG002:
  short_description: "Unused method argument"
  manual_instructions: "Remove unused method argument or prefix with underscore"
  proactive_guidance: "Same as ARG001: remove or prefix with underscore for interface compliance (e.g. implementing a protocol)."

ruff.PLR0913:
  short_description: "Too many arguments"
  manual_instructions: "Reduce number of function arguments. Consider grouping related args into a dataclass/config object."
  proactive_guidance: "Keep functions to a small number of arguments (e.g. <= 5). Group related parameters into a dataclass or config object."
  references: ["https://docs.astral.sh/ruff/rules/"]

ruff.C901:
  short_description: "Cyclomatic complexity too high"
  manual_instructions: "Reduce cyclomatic complexity by extracting logic into smaller functions"
  proactive_guidance: "Extract branches and loops into helper functions to keep complexity low per function."

ruff.PLR0912:
  short_description: "Too many branches"
  manual_instructions: "Reduce number of branches. Consider early returns, lookup tables, or strategy pattern"
  proactive_guidance: "Prefer early returns and dict/strategy dispatch over long if/elif chains."

ruff.B008:
  short_description: "Mutable default argument"
  manual_instructions: "Move default mutable argument (list/dict) inside function body with 'if arg is None: arg = []'."
  proactive_guidance: "Do not use mutable defaults (e.g. def f(x=[])). Use None and assign inside the function: def f(x=None): x = [] if x is None else x."
  references: ["https://docs.astral.sh/ruff/rules/"]

ruff.I001:
  short_description: "Import order violation"
  manual_instructions: "Run `ruff check <file> --fix --unsafe-fixes` to automatically sort imports. You can also run `ruff check src/excelsior_architect/stubs/snowflake/connector.pyi --fix --unsafe-fixes` for specific files."
  proactive_guidance: "Keep imports sorted: standard library first, then third-party, then local imports. Use `ruff check --fix` to automate this."
  references: ["https://docs.astral.sh/ruff/rules/unsorted-imports/"]

ruff.UP045:
  short_description: "Use `X | Y` for type unions"
  manual_instructions: "Run `ruff check <file> --fix --unsafe-fixes` to automatically convert `Union[X, Y]` to `X | Y`. This is an unsafe fix because it requires Python 3.10+."
  proactive_guidance: "Use the `X | Y` syntax for unions instead of `typing.Union` or `typing.Optional` when targeting Python 3.10+."
  references: ["https://docs.astral.sh/ruff/rules/non-pep604-annotation/"]

ruff._default:
  short_description: "Ruff rule violation"
  manual_instructions: "See Ruff documentation: https://docs.astral.sh/ruff/rules/. Most rules can be fixed with `ruff check <file> --fix --unsafe-fixes`."
  proactive_guidance: "Follow Ruff's rule set for style and correctness; run ruff check and fix before committing."

# --- Excelsior (architectural) ---
# One entry per rule, keyed by code (excelsior.W* / F*). GuidanceService resolves by code or symbol
# (e.g. get_excelsior_entry("banned-any-usage") finds excelsior.W9016 via symbol). No duplicate symbol-keyed entries.
# Scoring (optional): impact_weight 1-10, confidence 0.0-1.0, effort_category 1-5, eli5_description for priority score.
excelsior._default:
  impact_weight: 5
  confidence: 0.9
  effort_category: 3
  eli5_description: "This rule helps keep the codebase maintainable and aligned with Clean Architecture."

excelsior.W9001:
  symbol: clean-arch-dependency
  display_name: Illegal Dependency
  impact_weight: 9
  confidence: 0.95
  effort_category: 4
  eli5_description: "Inner layers (Domain) must not depend on outer layers (Infrastructure). Flip the dependency using a Protocol."
  message_template: "Illegal Dependency: %s layer is imported by %s layer. Clean Fix: Invert dependency using an Interface/Protocol in the Domain layer."
  fixable: true
  comment_only: true
  short_description: "Wrong dependency direction (e.g. Interface importing Infrastructure)"
  manual_instructions: "Infrastructure must not be imported by Interface (or similar). Invert: define a Port/Protocol in Domain, implement in Infrastructure, inject into Interface."
  proactive_guidance: "Dependencies point inward. Domain has no external deps; UseCase/Interface depend on Domain; Infrastructure implements Domain protocols. Never let outer layers import inner implementation details."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9004:
  symbol: clean-arch-resources
  display_name: Forbidden I/O
  impact_weight: 10
  confidence: 0.95
  effort_category: 4
  eli5_description: "Domain and UseCase must not do I/O (files, network, DB). Put I/O in Infrastructure and inject it via a Protocol."
  message_template: "Forbidden I/O access (%s) in %s layer. Clean Fix: Move logic to Infrastructure and inject via a Domain Protocol."
  fixable: true
  comment_only: true
  short_description: "I/O or heavy dependency in Domain/UseCase"
  manual_instructions: "Move I/O (e.g. import astroid, file access) out of Domain/UseCase. Create a Domain protocol (interface) and implement it in Infrastructure. Inject the implementation via constructor."
  proactive_guidance: "Domain and UseCase must not import infrastructure or do I/O. Define a Protocol in domain, implement in infrastructure, inject via constructor (dependency inversion)."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9006:
  symbol: clean-arch-demeter
  display_name: Law of Demeter
  impact_weight: 6
  confidence: 0.7
  effort_category: 3
  eli5_description: "Don't chain through objects (a.b.c). Ask the object you have to do something; it can talk to others."
  message_template: "Law of Demeter: Chain access (%s) exceeds one level. Create delegated method. Clean Fix: Add a method to the immediate object that performs the operation."
  fixable: true
  comment_only: true
  short_description: "Law of Demeter violation (chained access)"
  manual_instructions: "Manual architectural change required. Extract this chain into a delegated method on the immediate dependency to preserve encapsulation. Do not use temporary variables as a workaround - this is a linter cheat that bypasses the architectural issue."
  proactive_guidance: "Do not chain through objects (a.b.c.d). Call a method on the object you have; that method may call the next. One dot: friend.do_thing() not friend.thing.do_action()."
  references: ["docs/ARCHITECTURE_ONBOARDING.md", "RULES.md"]

excelsior.W9601:
  symbol: domain-immutability-violation
  display_name: Domain Immutability
  message_template: "Domain Immutability Violation: Attribute assignment in %s layer. Clean Fix: Use dataclasses with frozen=True or namedtuples."
  fixable: true
  comment_only: false
  short_description: "Mutable domain entity"
  manual_instructions: "Use @dataclass(frozen=True) or namedtuple for Domain types. Run 'excelsior fix' for auto-freeze where applicable."
  proactive_guidance: "Domain entities should be immutable. Use @dataclass(frozen=True) or namedtuple. No attribute assignment after construction."
  references: ["RULES.md"]

excelsior.W9016:
  symbol: banned-any-usage
  display_name: Banned Any
  message_template: "Banned Any: Explicit use of 'Any' detected in %s. Clean Fix: Use specific astroid.nodes types or Domain Entities."
  fixable: true
  comment_only: true
  short_description: "Use of Any type"
  manual_instructions: "Avoid 'Any'. Use specific types from typing or your domain. See banned-any-usage."
  proactive_guidance: "Prefer concrete types over Any. Use Protocol, TypeVar, or domain types. Any disables type checking and hides bugs."
  references: ["RULES.md"]

excelsior.W9003:
  symbol: clean-arch-protected
  display_name: Protected Member Access
  message_template: "Access to protected member '%s'. Use public interface or add a use case."
  short_description: "Access to protected member"
  manual_instructions: "Access to protected member. Use public interface or add a use case."
  proactive_guidance: "Do not access _protected members from outside the class. Use public API or add a use case that owns the interaction."
  references: ["RULES.md"]

excelsior.W9005:
  symbol: clean-arch-delegation
  display_name: Delegation Anti-Pattern
  message_template: "Delegation Anti-Pattern: %s Clean Fix: Implement logic in the delegate or use a Map/Dictionary lookup."
  fixable: true
  comment_only: true
  short_description: "Delegation anti-pattern"
  manual_instructions: "Delegation anti-pattern. Use Strategy, Handler, or dict-based dispatch."
  proactive_guidance: "Avoid deep delegation chains. Prefer Strategy, Handler, or a single dispatch map."
  references: ["RULES.md"]

excelsior.W9010:
  symbol: clean-arch-god-file
  display_name: God File
  impact_weight: 6
  confidence: 0.9
  effort_category: 4
  eli5_description: "One file is doing too much. Split it into smaller files, each with one job."
  message_template: "God File detected: %s. Clean Fix: Split into separate files."
  fixable: true
  comment_only: true
  short_description: "God file (too many responsibilities)"
  manual_instructions: "God file detected. Split into smaller modules by responsibility."
  proactive_guidance: "Keep files focused. One main responsibility per module; split large files by cohesive behavior."
  references: ["RULES.md"]

excelsior.W9011:
  symbol: clean-arch-folder-structure
  display_name: Deep Structure
  message_template: "Deep Structure violation: Module '%s' in project root. Clean Fix: Move to a sub-package."
  fixable: true
  comment_only: true
  short_description: "Folder layout does not match layers"
  manual_instructions: "Adjust folder layout to match Clean Architecture layers. See .agent/instructions.md."
  proactive_guidance: "Organize code into domain, use_cases, interface, infrastructure. Keep layer boundaries clear."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9012:
  symbol: defensive-none-check
  display_name: Defensive None Check
  message_template: "Defensive None Check: '%s' checked for None in %s layer. Validation belongs in Interface layer. Clean Fix: Ensure the value is validated before entering core logic."
  fixable: true
  comment_only: true
  short_description: "Defensive None Check in wrong layer"
  manual_instructions: "Move None checks to Interface layer. Ensure the value is validated before entering core logic."
  proactive_guidance: "Validation belongs in Interface layer. Do not check for None in Domain/UseCase."
  references: ["RULES.md"]

excelsior.W9007:
  symbol: naked-return-violation
  display_name: Naked Return
  message_template: "Naked Return: %s returned from Repository. Return Entity instead. Clean Fix: Map the raw object to a Domain Entity before returning."
  fixable: true
  comment_only: true
  short_description: "Repository returning raw type instead of Entity"
  manual_instructions: "Map the raw object to a Domain Entity before returning from Repository."
  proactive_guidance: "Repositories should return Domain entities, not raw infrastructure types."
  references: ["RULES.md"]

excelsior.W9009:
  symbol: missing-abstraction-violation
  display_name: Missing Abstraction
  message_template: "Missing Abstraction: %s holds reference to %s. Use Domain Entity. Clean Fix: Replace the raw object with a Domain Entity or Value Object."
  fixable: true
  comment_only: true
  short_description: "Raw type used instead of Domain Entity"
  manual_instructions: "Replace the raw object with a Domain Entity or Value Object."
  proactive_guidance: "Use Domain entities and value objects, not raw infrastructure types."
  references: ["RULES.md"]

excelsior.W9013:
  symbol: illegal-io-operation
  display_name: Illegal I/O Operation
  message_template: "Illegal I/O Operation: '%s' called in silent layer '%s'. Clean Fix: Delegate I/O to an Interface/Port (e.g., %s)."
  fixable: true
  comment_only: true
  short_description: "I/O in wrong layer"
  manual_instructions: "Delegate I/O to an Interface/Port. Do not call I/O from Domain/UseCase."
  proactive_guidance: "I/O belongs in Infrastructure. Use Ports/Protocols and inject implementations."
  references: ["RULES.md"]

excelsior.W9014:
  symbol: ui-concern-in-domain
  display_name: UI Concern in Domain
  message_template: "UI concern in Domain layer: %s. Clean Fix: Move UI/formatting to Infrastructure (e.g. AnalysisRendererProtocol)."
  fixable: false
  comment_only: false
  short_description: "UI/formatting in domain layer"
  manual_instructions: "Move ANSI codes, emoji, isatty() and formatting to Infrastructure."
  proactive_guidance: "Domain must not depend on UI. Use ports and inject renderers."
  references: ["RULES.md"]

excelsior.W9017:
  symbol: clean-arch-layer-integrity
  display_name: Layer Integrity
  message_template: "Layer Integrity violation: File '%s' is unmapped. Clean Fix: Add to [tool.clean-arch.layer_map] in pyproject.toml."
  fixable: false
  comment_only: false
  short_description: "File not in layer map"
  manual_instructions: "Add the file to [tool.clean-arch.layer_map] in pyproject.toml."
  proactive_guidance: "All files in src/ must be mapped to an architectural layer."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9018:
  symbol: clean-arch-class-only
  display_name: Top-level functions
  message_template: "Module '%s' contains top-level functions. Only allowlisted entry-point modules (e.g. __main__.py) may have top-level functions. Clean Fix: Move logic into service classes."
  fixable: false
  comment_only: false
  short_description: "Top-level functions not allowed"
  manual_instructions: "Move logic into service classes. Only __main__.py (or allowlisted entry points) may have top-level functions."
  proactive_guidance: "No top-level functions except in hard-wired allowlist (e.g. __main__.py)."
  references: ["RULES.md"]

excelsior.W9101:
  symbol: fragile-test
  display_name: Fragile Test
  message_template: "Fragile Test: %d mocks exceed limit of 4. Inject single Protocol instead. Clean Fix: Use a single Fake or Stub implementation of a Protocol rather than mocking many individual methods."
  fixable: false
  comment_only: false
  short_description: "Too many mocks in test"
  manual_instructions: "Use a single Fake or Stub implementation of a Protocol rather than mocking many individual methods."
  proactive_guidance: "Prefer one Protocol stub over many mocks."
  references: ["RULES.md"]

excelsior.W9102:
  symbol: private-method-test
  display_name: Testing private method
  message_template: "Testing private method: %s. Test the execute() behavior instead. Clean Fix: Test the public API method that calls this private method."
  fixable: false
  comment_only: false
  short_description: "Testing private method"
  manual_instructions: "Test the public API method that calls this private method."
  proactive_guidance: "Test the public API, not private implementation details."
  references: ["RULES.md"]

excelsior.W9201:
  symbol: contract-integrity-violation
  display_name: Contract Integrity
  impact_weight: 10
  confidence: 0.95
  effort_category: 3
  eli5_description: "Infrastructure classes should implement a Protocol defined in Domain, so the rest of the app doesn't depend on concrete implementations."
  message_template: "Contract Integrity Violation: Class '%s' in infrastructure layer must inherit from a Domain Protocol. Clean Fix: Define a Protocol in the domain layer and implement it here."
  fixable: true
  comment_only: true
  short_description: "Infrastructure class not implementing Domain protocol"
  manual_instructions: "Class in Infrastructure must implement a Domain protocol. Define a Protocol in the domain layer, then make the class inherit it."
  proactive_guidance: "Every infrastructure adapter should implement a protocol defined in domain. Define the interface first, then implement."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9202:
  symbol: concrete-method-stub
  display_name: Concrete Method Stub
  message_template: "Concrete Method Stub: Method '%s' has no implementation but is not marked as abstract. Clean Fix: Add implementation or use @abstractmethod."
  fixable: false
  comment_only: false
  short_description: "Method has no implementation"
  manual_instructions: "Add implementation or use @abstractmethod."
  proactive_guidance: "Concrete methods must have implementation; abstract methods use @abstractmethod."
  references: ["RULES.md"]

excelsior.W9301:
  symbol: di-enforcement-violation
  display_name: DI Violation
  message_template: "DI Violation: %s instantiated directly in UseCase. Use constructor injection. Clean Fix: Pass the dependency as an argument to __init__."
  fixable: true
  comment_only: true
  short_description: "Direct instantiation of Infrastructure in UseCase"
  manual_instructions: "Use constructor injection. Pass dependencies in __init__; do not instantiate Infrastructure inside UseCase."
  proactive_guidance: "UseCase receives dependencies via __init__. Never call ConcreteClass() inside a use case; receive a Protocol and inject the implementation."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9501:
  symbol: anti-bypass-violation
  display_name: Anti-Bypass
  message_template: "Anti-Bypass Violation: %s detected. %s Clean Fix: Justify with '# JUSTIFICATION: <reason>' or resolve the architectural issue."
  fixable: true
  comment_only: true
  short_description: "Bypass/suppression of rule"
  manual_instructions: "Remove bypass comments. Fix the underlying violation instead of suppressing."
  proactive_guidance: "Do not suppress architectural rules. Fix the design so the violation does not occur."
  references: ["RULES.md"]

excelsior.clean-arch-import:
  short_description: "Domain importing outer layer"
  manual_instructions: "Remove the violating import. Domain cannot import Infrastructure. Use dependency inversion (Protocol in Domain, impl in Infra)."
  proactive_guidance: "Domain must not import interface or infrastructure. Dependencies point inward only."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9015:
  symbol: missing-type-hint
  display_name: Missing Type Hint
  message_template: "Missing Type Hint: %s in %s signature. Clean Fix: Add explicit type hints to all parameters and the return value."
  fixable: true
  comment_only: false
  short_description: "Missing type hint (Excelsior)"
  manual_instructions: "Add explicit type hints to all parameters and return type. See .agent/instructions.md and RULES.md for examples."
  proactive_guidance: "Add type hints to every function and method. Use def f(x: int) -> str: and -> None for no return."
  references: ["RULES.md"]

excelsior.F0002:
  symbol: pylint-crash
  display_name: Pylint/astroid crash
  message_template: "Pylint/astroid crash. Ensure types passed to inference (e.g. qname) are strings. Report reproducible cases to the plugin repo."
  fixable: false
  comment_only: false
  short_description: "Pylint/astroid crash"
  manual_instructions: "Pylint/astroid crash. Ensure types passed to inference (e.g. qname) are strings. Report reproducible cases to the plugin repo."
  proactive_guidance: "Avoid passing non-string or invalid values to APIs that the linter infers from (e.g. qname). Use strings for qualified names."
  references: []

excelsior.clean-arch-protected:
  short_description: "Protected attribute exposure"
  manual_instructions: "Make the attribute private (_name) or expose via @property."
  proactive_guidance: "Use _name for implementation details; expose via @property or methods when callers need access."

excelsior.W9019:
  symbol: clean-arch-unstable-dep
  display_name: Unstable Dependency
  message_template: "Dependency %s is uninferable. Create stubs/%s.pyi to establish architectural truth."
  fixable: true
  comment_only: false
  short_description: "External dependency without stubs"
  manual_instructions: "Create stubs/<module>.pyi for the external dependency so the linter can resolve types. Example: stubs/snowflake/connector.pyi for snowflake.connector."
  proactive_guidance: "For untyped third-party libs, add stubs under stubs/<package>/ so the linter can resolve types. Use TYPE_CHECKING for optional imports."
  references: ["RULES.md"]

excelsior.W9020:
  symbol: clean-arch-no-global-state
  display_name: Global State
  message_template: "Global state: use of 'global' in '%s'. Clean Fix: Use dependency injection or explicit state via constructors; avoid module-level mutable state."
  fixable: true
  comment_only: true
  short_description: "Use of 'global' or module-level mutable state"
  manual_instructions: "Remove use of 'global'. Manage state via dependency injection (constructor or composition root), instance attributes, or explicit singletons (e.g. DI container); avoid module-level mutable state."
  proactive_guidance: "State belongs in: (1) composition root / DI container for app-wide singletons, (2) instance attributes for per-object state, (3) explicit service/registry classes. Do not use the 'global' keyword or module-level mutable variables for application state."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9030:
  symbol: architectural-entropy
  display_name: Architectural Entropy
  message_template: "Architectural entropy: identifier '%s' defined in %d place(s): %s. Clean Fix: Single source of truth — choose one canonical source, move definitions there, remove from others."
  fixable: true
  comment_only: true
  short_description: "Architectural entropy: same concept defined in multiple places"
  manual_instructions: "Single source of truth: choose one canonical source (e.g. rule_registry.yaml, or one module), move all definitions there, remove from others. All consumers should read from that place; do not add parallel lists, sets, or dicts elsewhere."
  proactive_guidance: "When adding a concept (rules, config, feature flags, etc.), define it in one place. All consumers read from that place. Do not add the same identifier to multiple files in definition contexts (list/set/dict of codes, symbols, etc.)."
  references: ["docs/ARCHITECTURAL_ENTROPY.md"]

excelsior.W9032:
  symbol: method-complexity
  display_name: Method Complexity
  message_template: "Method '%s' has cyclomatic complexity %s (threshold %s). Extract logic into smaller functions."
  fixable: true
  comment_only: false
  short_description: "Per-method cyclomatic complexity exceeds threshold"
  manual_instructions: "Reduce cyclomatic complexity by extracting branches and loops into smaller helper functions."
  proactive_guidance: "Keep methods focused; extract logic into private helpers or domain functions to stay under the complexity threshold."
  references: ["RULES.md"]

excelsior.W9033:
  symbol: interface-segregation
  display_name: Interface Segregation
  message_template: "Protocol '%s' has %s methods (limit %s). Consider splitting into focused sub-protocols."
  fixable: true
  comment_only: true
  short_description: "Protocol with too many methods (ISP violation)"
  manual_instructions: "Split the protocol into smaller, focused sub-protocols so implementers only depend on what they use."
  proactive_guidance: "Keep protocols small; prefer several focused protocols over one large one."
  references: ["RULES.md"]

excelsior.W9034:
  symbol: constructor-injection
  display_name: Constructor Injection
  message_template: "Parameter '%s' in %s.__init__ is typed to concrete '%s'. Prefer a Protocol and inject the implementation."
  fixable: true
  comment_only: true
  short_description: "Dependency typed to concrete class instead of Protocol"
  manual_instructions: "Type __init__ parameters to Protocol (or abstract base); inject the concrete implementation at composition root."
  proactive_guidance: "Dependencies via __init__; type to Protocol, not concrete class."
  references: ["docs/ARCHITECTURE_ONBOARDING.md"]

excelsior.W9035:
  symbol: exception-hygiene
  display_name: Exception Hygiene
  message_template: "%s"
  fixable: false
  comment_only: false
  short_description: "Bare except, except Exception without re-raise, or empty except body"
  manual_instructions: "Use 'except Exception:' (or specific type) and re-raise or log; avoid bare except: and empty except bodies."
  proactive_guidance: "Catch specific exceptions; re-raise or log and re-raise; never swallow with empty body."
  references: ["RULES.md"]

excelsior.W9041:
  symbol: builder-suggestion
  display_name: Builder Suggestion
  message_template: "__init__ of '%s' has %s parameters; consider Builder pattern."
  fixable: false
  comment_only: false
  short_description: "Suggestion: __init__ with 6+ parameters (consider Builder)"
  manual_instructions: "Consider Builder pattern or a config dataclass when __init__ has many parameters."
  proactive_guidance: "Group related parameters into a config object or use Builder for complex construction."
  references: ["RULES.md"]

excelsior.W9042:
  symbol: factory-suggestion
  display_name: Factory Suggestion
  message_template: "if/elif instantiating different classes (%s); consider Factory."
  fixable: false
  comment_only: false
  short_description: "Suggestion: if/elif instantiating different classes (consider Factory)"
  manual_instructions: "Consider Factory or factory function to encapsulate object creation."
  proactive_guidance: "Use Factory when creation logic varies by condition."
  references: ["RULES.md"]

excelsior.W9043:
  symbol: strategy-suggestion
  display_name: Strategy Suggestion
  message_template: "if/elif chain with %s branches selecting behavior; consider Strategy pattern."
  fixable: false
  comment_only: false
  short_description: "Suggestion: if/elif selecting algorithms (consider Strategy)"
  manual_instructions: "Consider Strategy pattern to replace conditional algorithm selection."
  proactive_guidance: "Inject strategy objects instead of branching on type or flag."
  references: ["RULES.md"]

excelsior.W9044:
  symbol: state-suggestion
  display_name: State Suggestion
  message_template: "Repeated conditionals on '%s' in %s methods; consider State pattern."
  fixable: false
  comment_only: false
  short_description: "Suggestion: repeated conditionals on same state (consider State)"
  manual_instructions: "Consider State pattern when multiple methods branch on the same state attribute."
  proactive_guidance: "Encapsulate state-specific behavior in state objects."
  references: ["RULES.md"]

excelsior.W9045:
  symbol: facade-suggestion
  display_name: Facade Suggestion
  message_template: "Method '%s' calls %s distinct dependency objects; consider Facade."
  fixable: false
  comment_only: false
  short_description: "Suggestion: method calls 5+ dependencies (consider Facade)"
  manual_instructions: "Consider Facade or orchestrator to simplify caller's view of multiple dependencies."
  proactive_guidance: "Group related operations behind a single facade when a method coordinates many dependencies."
  references: ["RULES.md"]

excelsior._default:
  short_description: "Excelsior architectural violation"
  manual_instructions: "See .agent/instructions.md and RULES.md. Fix the underlying architectural violation; avoid bypasses."
  proactive_guidance: "Follow Clean Architecture: dependencies inward, domain has no I/O, use protocols and constructor injection. See docs/ARCHITECTURE_ONBOARDING.md."

excelsior.R0801:
  symbol: duplicate-code
  display_name: Duplicate Code
  impact_weight: 4
  confidence: 0.85
  effort_category: 3
  eli5_description: "Same code in multiple places is hard to maintain. Extract it into one shared place (DRY)."
  message_template: "Similar lines in %d files"
  fixable: false
  comment_only: false
  short_description: "Duplicated code detected across files"
  manual_instructions: "Refactor duplicated logic into a shared component, utility, or base class. Follow DRY (Don't Repeat Yourself) principles while maintaining appropriate layer boundaries."
  proactive_guidance: "Avoid copy-pasting code. If logic is needed in multiple places, extract it to a common service or utility module."
  references: ["https://pylint.readthedocs.io/en/latest/user_guide/messages/refactor/duplicate-code.html"]

# --- Import-Linter (contracts) ---
import_linter.contract:
  short_description: "Layer contract or import contract violated"
  manual_instructions: "Remove or refactor the import that breaks the contract. 1) Check pyproject.toml [tool.importlinter] for defined contracts. 2) Move the imported code to an allowed layer, or invert the dependency (e.g. use a Port). 3) Ensure the importing module lives in a layer that may depend on the imported module."
  proactive_guidance: "Respect [tool.importlinter] contracts. Do not import from a layer that the contract forbids. Invert dependencies with Ports/Protocols in the allowed layer."
  references: ["https://github.com/seddons/import-linter"]
